#+TITLE: A Makefile for C Codes
#+OPTIONS: num:6

#+BEGIN_SRC makefile
CC := /usr/bin/clang
INC := $(foreach dirs, $(shell find $(shell pwd) -iname '*.h'), $(dirs))
SRC := $(foreach dirs, $(shell find $(shell pwd) -iname '*.c'), $(dirs))
OBJ := $(subst .c,.o, $(SRC))
BIN := sls

ifdef RELEASE
	FLAGS := -O2
else
	FLAGS := -g
endif

%.o: %.c
	@echo "Building object file $@ ..."
	@$(CC) -c -o $@ $< $(FLAGS)

$(BIN): $(OBJ)
	@echo "Linking object files and creating binary program ..."
	@$(CC) $^ -o $@ -lm -lgsl -lgslcblas

.phony: default clean
default all: $(BIN)
clean:
	@echo "Removing all object files ..."
	@-rm -f $(OBJ)
#+END_SRC
