#+TITLE: NR - Channel State Information Reference Signal (CSI-RS)
#+MACRO: rrc @@html:<span style="color: blue">$1</span>@@@@latex:\textcolor{blue}{$1}@@
#+MACRO: dci @@html:<span style="color: orange">$1</span>@@@@latex:\textcolor{orange}{$1}@@

* Introduction
In NR system, /channel state information reference signal (CSI-RS)/ plays a variety of roles, including
- CSI measurement
- Beam management
- Tracking
- Mobility management
- Rate match

Generally, there are two types of CSI-RS, termed /non-zero-power (NZP)/ CSI-RS and /zero-power (ZP)/ CSI-RS, respectively. The former is configured by {{{rrc(NZP-CSI-RS-Resource)}}} or {{{rrc(CSI-RS-Resource-Mobility)}}} in {{{rrc(CSI-RS-ResourceConfigMobility)}}}, while the latter is configured by {{{rrc(ZP-CSI-RS-Resource)}}}.
* Sequence Generation
CSI-RS symbols are a sequence of QPSK-modulated Gold sequence, which is initialized with
\begin{align*}
  c_{\text{init}} = \left[ 2^{10}(N_{\text{symb}}^{\text{slot}}n_{s,f}^{\mu} + \ell + 1)(2n_{\text{ID}}+1) + n_{\text{ID}} \right] \mod 2^{31}
\end{align*}
where
- $N_{\text{symb}}^{\text{slot}}$ is the number of symbols in a slot.
- $n_{s,f}^{\mu}$ is the index of the slot within a frame.
- $\ell$ is the index of the symbol within a slot.
- $n_{\text{ID}}$ is configured by {{{rrc(scramblingID)}}} or {{{rrc(sequenceGenerationConfig)}}}.
* Resource Mapping
** Parameters
Regarding the resource mapping of CSI-RS, following parameters are involved.
- Density $\rho$ is configured by {{{rrc(density)}}} in {{{rrc(CSI-RS-ResourceMapping)}}}/{{{rrc(CSI-RS-CellMobility)}}}.
- Port number $X$ is configured by {{{rrc(nrofPorts)}}}.
- Power offset $\beta_{\text{CSIRS}}$ is configured by {{{rrc(powerControlOffsetSS)}}} in {{{rrc(NZP-CSI-RS-Resource)}}}.
- CDM type is configured by {{{rrc(cdm-Type)}}} in {{{rrc(CSI-RS-ResourceMapping)}}}.
- Time-domain location
  + Slot-level: period and offset are indicated by {{{rrc(CSI-ResourcePeriodicityAndOffset)}}}/{{{rrc(slotConfig)}}}.
  + Symbol-level: $\ell_0 \in \left\{0, 1, \ldots, 13\right\}$ and $\ell_1 \in \left\{2, 3, \ldots, 12\right\}$ are respectively configured by {{{rrc(firstOFDMSymbolInTimeDomain)}}} and {{{rrc(firstOFDMSymbolInTimeDomain2)}}} in {{{rrc(CSI-RS-ResourceMapping)}}}/{{{rrc(CSI-RS-ResourceConfigMobility)}}}.
- Frequency-domain location
  + RB-level: the starting position and number are configured by
    - {{{rrc(freqBand)}}} and {{{rrc(density)}}} in {{{rrc(CSI-RS-ResourceMapping)}}}, or
    - {{{rrc(startPRB)}}} and {{{rrc(nrofPRBs)}}} in {{{rrc(csi-rs-MeasurementBW)}}} in {{{rrc(CSI-RS-CellMobility)}}}.
  + Subcarrier-level: indicated by a bitmap configured by {{{rrc(frequencyDomainAllocation)}}} in {{{rrc(CSI-RS-ResourceMapping)}}}/{{{rrc(CSI-RS-ResourceConfigMobility)}}}.
** Patterns
In NR systems, 1/2/4/8/12/16/24/32-port CSI-RS are defined. The multi-port CSI-RS are constructed based on 2/4-port CSI-RS using frequency domain (FD) and time domain (TD) /orthogonal cover code (OCC)/. The coordinate of a CSI-RS resource in the resource grid is indicated by a bitmap.
- A single-port CSI-RS resource occupies one RE.
- A 2-port CSI-RS resource occupies 2 x 1 RE's.
- A 4-port CSI-RS resource occupies 4 x 1 or 2 x 2 RE's.

* Functionality
** CSI-RS for CSI Measurement
*** Framework
Just as its name indicates, CSI-RS can be used to measure CSI, e.g., CQI, PMI, CRI, SS/PBCH block resource indicator (SSBRI), layer indicator (LI), RI, L1-RSRP.

A UE can be configured with
- $N \ge 1$ {{{rrc(CSI-ReportConfig)}}}, in which
  + The time domain behavior is indicated by {{{rrc(reportConfigType)}}}, whose candidate values are {{{rrc(aperiodic)}}}/{{{rrc(periodic)}}}/{{{rrc(semiPersistentOnPUCCH)}}}/{{{rrc(semiPersistentOnPUSCH)}}}.
  + CSI-related or L1-RSRP-related quantities are indicated by {{{rrc(reportQuantity)}}};
  + Reporting granularity in the frequency domain is indicated by {{{rrc(reportFreqConfiguration)}}}.
  + Time domain restriction for channel and interference measurements (IM) are indicated by {{{rrc(timeRestrictionForChannelMeasurements)}}} and {{{rrc(timeRestrictionForInterferenceMeasurements)}}}, respectively.
  + Codebook-related configurations are indicated by {{{rrc(CodebookConfig)}}}.
- $M \ge 1$ {{{rrc(CSI-ResourceConfig)}}}, in which
  + $S \ge 1$ CSI resource sets are indicated by {{{rrc(csi-RS-ResourceSetList)}}}.
  + The time domain behavior is indicated by {{{rrc(resourceType)}}}, whose candidate values are {{{rrc(aperiodic)}}}/{{{rrc(periodic)}}}/{{{rrc(semi-persistent)}}}. All the {{{rrc(CSI-ResourceConfig)}}} linked to one {{{rrc(CSI-ReportConfig)}}} have the same time domain behavior.
  + The NZP CSI-RS resource(s) for channel/interference measurement and CSI-IM resource(s) for IM corresponding to one {{{rrc(CSI-ReportConfig)}}} are QCLed with respect to {{{rrc(QCL-TypeD)}}}.
- One or two lists of trigger states ({{{rrc(CSI-AperiodicTriggerStateList)}}} and {{{rrc(CSI-SemiPersistentOnPUSCH-TriggerStateList)}}}), with each trigger state consisting of a list of associated {{{rrc(CSI-ReportConfig)}}}.
*** NZP CSI-RS
For each {{{rrc(CSI-ResourceConfig)}}}, a UE can be configured with one or more NZP CSI-RS resource set(s) by {{{rrc(NZP-CSI-RS-ResourceSet)}}}, with each consisting of $K \ge 1$ NZP CSI-RS resource(s).
- All the CSI-RS resource(s) except the NZP CSI-RS resources used for IM within one set are configured with the same {{{rrc(density)}}} and {{{rrc(nrofPorts)}}}.
- All the CSI-RS resource(s) within one set are expected to configured with the same {{{rrc(startingRB)}}}, {{{rrc(nrofRBs)}}}, and {{{rrc(cdm-type)}}}.
*** CSI-IM
A UE can be configured with one or more CSI-IM resource set(s) by {{{rrc(CSI-IM-ResourceSet)}}}, with each consisting of $K \ge 1$ {{{rrc(CSI-IM-Resource)}}}, in which
- 

** CSI-RS for Tracking
In NR system, a single-port CSI-RS is used as /tracking reference signal (TRS)/, targetting for time/frequency tracking.

# #+BEGIN_SRC latex :file nr_trs_1sym.png :imagemagick yes :headers '("\\usepackage{tikz}") :fit yes :iminoptions -density 800
#   \begin{tikzpicture}
#       \draw (0, 0) -- (1, 0);
#   \end{tikzpicture}
# #+END_SRC

# #+name: fig:trs
# #+caption: CSI-RS for tracking
# #+attr_html: :width 900px
# [[file:nr_trs_1sym.png]]

- /Periodic TRS/ is essentially a periodic CSI-RS resource set, which is configured by high layer signalling.
- /Aperiodic TRS/ has the same structure as periodic TRS. The difference lies that it is triggered by /downlink control information (DCI)/.
** CSI-RS for Rate Match
In NR system, zero-power (ZP) CSI-RS can be used for rate match, which is exclusive for PDSCH transmission. There are 3 types of ZP-CSI-RS, periodic, semi-persistent, and aperiodic.
